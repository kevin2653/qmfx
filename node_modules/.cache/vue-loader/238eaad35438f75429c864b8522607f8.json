{"remainingRequest":"E:\\HtmlProjects\\qmfx\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\HtmlProjects\\qmfx\\src\\components\\prod\\prodInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\HtmlProjects\\qmfx\\src\\components\\prod\\prodInfo.vue","mtime":1578412477773},{"path":"E:\\HtmlProjects\\qmfx\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\HtmlProjects\\qmfx\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1577370171724},{"path":"E:\\HtmlProjects\\qmfx\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {\n  getProdDetailAPI,\n  getprodTypeListtAPI,\n  pushProdDataAPI,\n  putProdDataAPI,\n  getTemplateListAPI\n}from '@/api/productApi.js'\nimport axios from 'axios';\nimport { treeDataTranslate, idList } from '@/utils'\nimport E from 'wangeditor';\nexport default {\n   name:'editor',\n  data () {\n    return {\n      // 分类树展示与回显\n       videoFlag:false,      //刚开始的时候显示为flase\n      videoUploadPercent: '0%',  //进度条刚开始的时候为0%\n      transportId: null,\n      shopid:0,\n      video:{},\n      shopup:'1',\n      shopdown:'1',\n      value1:'',\n      attrtext:'',\n      attributeDepList:[],\n      category: {\n        list: [],\n        selected: [],\n        props: {\n          value: 'categoryId',\n          label: 'categoryName'\n        }\n      },\n      rules: {\n        checkList: [\n                { type: 'array', required: true, message: '请选择代理购买方式', trigger: 'change' }\n              ],\n        picfile: [ \n            { required: true, message: '请上传图片' }          \n          ]\n      },\n      showvidio:'',\n      fileList:[],\n      prodtypelist:[],\n      allfreight:'',\n      AttributeDepShow:false,\n      secondDepShow:false,\n      imageShowUrl:'',\n      // 规格列表\n      shoptypelist:[],\n      skuList:[],\n      prodName:'',\n      dialogImageUrl: '',\n      dialogVisible: false,\n      dataForm: {\n        cover:'',\n        typeId:'',\n        productImageList:[]\n      },\n      tags: [],\n      retailFreightId:'',\n      freightlist:[]\n      // resourcesUrl: window.SITE_CONFIG.resourcesUrl\n    }\n  },\n  components: {\n  },\n  props: {\n    depId: {\n      required: true,\n    },\n  },\n  computed: {\n    defalutSku () {\n      return this.$store.state.prod.defalutSku\n    }\n  },\n  activated () {\n    this.dataForm.prodId = this.$route.query.prodId\n    this.getDataList()\n  },\n  methods: {\n    // 获取分类数据\n    getDataList () {\n     \n    },\n    delvidio(){\n      this.dataForm.video =''\n    },\n    handleRemove(file, fileList) {\n      // let this.dataForm.productImageDtos\n      for(let i=0;i<this.dataForm.productImageList.length;i++){\n        if(file.url==this.dataForm.productImageList[i].url){\n          this.dataForm.productImageList.splice(i,1)\n        }\n      }\n    },\n    uploadImgTwo(res){\n      this.dataForm.productImageList.push({\n        sort:0,\n        url:res.data\n      })\n    },\n    handlePictureCardPreview(file) {\n        this.dialogImageUrl = file.url;\n        this.dialogVisible = true;\n    },\n    removeDomain(item) {\n        for(let j=0;j<this.attributeDepList.length;j++){\n          if(this.attributeDepList[j].name==item.name){\n            this.attributeDepList.splice(j,1)\n          }\n        }\n      },\n    delshoptype(deltid){\n     for(let i=0;i<this.shoptypelist.length;i++){\n       if(this.shoptypelist[i].tid==deltid){\n         this.shoptypelist.splice(i,1)\n       }\n     }\n    },\n    uploadImg(res){\n      this.dataForm.cover = res.data;\n      this.imageShowUrl=res.data\n      this.rules.picfile = [{ required: true, message: '请上传图片' }] \n      if (this.dataForm.cover!='') {\n        this.rules.picfile = []\n      }\n    },\n    beforeAvatarUpload(file) {\n      const isJPG = file.type === 'image/jpeg' || file.type === 'image/png';\n      const isLt2M = file.size / 1024 / 1024 < 2;\n\n      if (!isJPG) {\n        this.$message.error('上传头像图片只能是 JPG或者PNG 格式!');\n      }\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 2MB!');\n      }\n      return isJPG && isLt2M;\n    },\n    // 视频上传\n     beforeUploadVideo(file) {          //视频上传之前判断他的大小\n      const isLt10M = file.size / 1024 / 1024  < 2000;\n      if (!isLt10M) {\n        this.$message.error('上传视频大小不能超过2000MB哦!');\n        return false;\n      }\n    },\n    uploadVideoProcess(event, file, fileList){    //视频上传的时候获取上传进度传给进度条\n      this.videoFlag = true;\n      this.videoUploadPercent = parseInt(file.percentage);\n      // console.log(this.videoUploadPercent)\n    },\n    handleVideoSuccess(res, file) {           //视频上传成功之后返回视频地址\n      this.videoFlag = false;\n      this.videoUploadPercent = 0;\n      // console.log(res)\n      this.dataForm.video=''\n      console.log(this.dataForm.video)\n      this.dataForm.video = res.data;\n    },\n    // 表单提交\n    dataFormSubmit () {\n          let that=this;\n        this.$refs['dataForm'].validate((valid) => {\n          if(valid){\n            if(this.shopid!=0){\n              const putdata={\n                cover: this.dataForm.cover,\n                detailMobile: this.dataForm.detailMobile,\n                price: this.dataForm.price,\n                typeId:this.dataForm.typeId,\n                productImageList:this.dataForm.productImageList,\n                productIntro: this.dataForm.productIntro,\n                productNumber: this.dataForm.productNumber,\n                sales: this.dataForm.sales,\n                title: this.dataForm.title,\n                totalStock: this.dataForm.totalStock,\n                video: this.dataForm.video,\n                pid:this.shopid,\n                retailFreightId:this.dataForm.retailFreightId\n              }\n              putProdDataAPI(putdata)\n                .then(res => {\n                    const sucresponse = res.data;\n                    if(sucresponse.code==200){\n                      this.$message({\n                        type: 'success',\n                        message: '修改产品成功',\n                      });\n                      this.$emit('close-form')\n                      this.$emit('finish-action')\n                    }else{\n                      this.errorMsg(sucresponse.message)\n                    }\n                })\n                .catch(err => {\n                  console.log(err)\n                    this.tableLoading = false;\n                }) \n            }else{\n              const pushdata={\n                cover: this.dataForm.cover,\n                detailMobile: this.dataForm.detailMobile,\n                price: this.dataForm.price,\n                typeId:this.dataForm.typeId,\n                productImageList:this.dataForm.productImageList,\n                productIntro: this.dataForm.productIntro,\n                productNumber: this.dataForm.productNumber,\n                sales: this.dataForm.sales,\n                title: this.dataForm.title,\n                totalStock: this.dataForm.totalStock,\n                video: this.dataForm.video,\n                retailFreightId:this.dataForm.retailFreightId\n              }\n              pushProdDataAPI(pushdata)\n                .then(res => {\n                    const response = res.data;\n                    if(response.code==200){\n                      this.$message({\n                        type: 'success',\n                        message: '添加产品成功',\n                      });\n                      this.$emit('close-form')\n                      this.$emit('finish-action')\n                    }else{\n                      this.errorMsg(response.message)\n                    }\n                })\n                .catch(err => {\n                  console.log(err)\n                    this.tableLoading = false;\n                })            \n            }\n          }\n         \n        })\n    },\n    getproddetail(id){\n      getProdDetailAPI(id)\n        .then(res => {\n          const data = res.data.data;\n          console.log(data)\n          this.dataForm=data\n            var editor = new E('#editorElem')\n            editor.customConfig.onchange = (html) => {\n              this.dataForm.detailMobile = html\n            }\n            this.rules.picfile = [{ required: true, message: '请上传图片' }] \n            if (this.dataForm.cover!='') {\n              this.rules.picfile = []\n            }\n            editor.customConfig.customUploadImg = (files, insert) => {\n              const formData = new FormData();\n              formData.append('files', files[0]);\n               axios.post(\"http://admin.zhanchengwlkj.com:8080/distribution_backstage/file/addFile\", formData, {\n                  headers: {\n                    \"Content-Type\": \"multipart/form-data\"\n                  }\n                }).then(res => {\n                  let { data } = res\n                  insert(data.data)  \n                  // 插入图片到editor\n                });\n              // formData.append('path', 'files/ne-icev3-dashboard/content/content/');\n              \n            };\n            editor.customConfig.uploadImgShowBase64 = true //图片以base64形式保存\n            editor.create()\n            editor.txt.html(this.dataForm.detailMobile)\n        })\n        .catch(err => {\n            this.tableLoading = false;\n        })\n    },\n    errorMsg (message) {\n      this.$message({\n        message: message,\n        type: 'error',\n        duration: 1500\n      })\n    },\n    getfreightlist(){\n        const getTempParam = {\n          current:1,\n          size:100\n        };\n        getTemplateListAPI(getTempParam)\n            .then(res => {\n                const response = res.data.data.records;\n                this.freightlist =response\n            })\n            .catch(err => {\n                this.tableLoading = false;\n            })\n    },\n  \n    geprodTypelist(){\n        const getTempParam = {\n          current:1,\n          size:100\n        };\n        getprodTypeListtAPI(getTempParam)\n            .then(res => {\n                const response = res.data.data;\n                this.prodtypelist =response\n            })\n            .catch(err => {\n                this.tableLoading = false;\n            })\n    }\n  },\n  mounted() {\n        //wangEditor自带方法\n        if(this.depId!=0){\n          this.shopid=this.depId\n          this.getproddetail(this.depId)\n        }else{\n            var editor = new E('#editorElem')\n            editor.customConfig.uploadImgShowBase64 = true //图片以base64形式保存\n            editor.customConfig.onchange = (html) => {\n              this.dataForm.detailMobile = html\n            }\n            editor.customConfig.customUploadImg = (files, insert) => {\n              const formData = new FormData();\n              formData.append('files', files[0]);\n               axios.post(\"http://admin.zhanchengwlkj.com:8080/distribution_backstage/file/addFile\", formData, {\n                  headers: {\n                    \"Content-Type\": \"multipart/form-data\"\n                  }\n                }).then(res => {\n                  let { data } = res\n                  insert(data.data)  \n                  // 插入图片到editor\n                });\n              // formData.append('path', 'files/ne-icev3-dashboard/content/content/');\n              \n            };\n            editor.customConfig.uploadImgShowBase64 = true //图片以base64形式保存\n            editor.create();\n            \n        }\n        this.geprodTypelist();\n        this.getfreightlist();\n    },\n}\n",null]}