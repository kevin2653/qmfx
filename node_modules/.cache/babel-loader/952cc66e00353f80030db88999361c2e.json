{"remainingRequest":"E:\\HtmlProjects\\qmfx\\node_modules\\thread-loader\\dist\\cjs.js!E:\\HtmlProjects\\qmfx\\node_modules\\babel-loader\\lib\\index.js!E:\\HtmlProjects\\qmfx\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\HtmlProjects\\qmfx\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\HtmlProjects\\qmfx\\src\\components\\prod\\prodInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\HtmlProjects\\qmfx\\src\\components\\prod\\prodInfo.vue","mtime":1578412477773},{"path":"E:\\HtmlProjects\\qmfx\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1577370171724},{"path":"E:\\HtmlProjects\\qmfx\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\HtmlProjects\\qmfx\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\HtmlProjects\\qmfx\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1577370171724},{"path":"E:\\HtmlProjects\\qmfx\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.array.iterator\";\nimport \"core-js/modules/es6.promise\";\nimport \"core-js/modules/es7.promise.finally\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getProdDetailAPI, getprodTypeListtAPI, pushProdDataAPI, putProdDataAPI, getTemplateListAPI } from '@/api/productApi.js';\nimport axios from 'axios';\nimport { treeDataTranslate, idList } from '@/utils';\nimport E from 'wangeditor';\nexport default {\n  name: 'editor',\n  data: function data() {\n    return {\n      // 分类树展示与回显\n      videoFlag: false,\n      //刚开始的时候显示为flase\n      videoUploadPercent: '0%',\n      //进度条刚开始的时候为0%\n      transportId: null,\n      shopid: 0,\n      video: {},\n      shopup: '1',\n      shopdown: '1',\n      value1: '',\n      attrtext: '',\n      attributeDepList: [],\n      category: {\n        list: [],\n        selected: [],\n        props: {\n          value: 'categoryId',\n          label: 'categoryName'\n        }\n      },\n      rules: {\n        checkList: [{\n          type: 'array',\n          required: true,\n          message: '请选择代理购买方式',\n          trigger: 'change'\n        }],\n        picfile: [{\n          required: true,\n          message: '请上传图片'\n        }]\n      },\n      showvidio: '',\n      fileList: [],\n      prodtypelist: [],\n      allfreight: '',\n      AttributeDepShow: false,\n      secondDepShow: false,\n      imageShowUrl: '',\n      // 规格列表\n      shoptypelist: [],\n      skuList: [],\n      prodName: '',\n      dialogImageUrl: '',\n      dialogVisible: false,\n      dataForm: {\n        cover: '',\n        typeId: '',\n        productImageList: []\n      },\n      tags: [],\n      retailFreightId: '',\n      freightlist: [] // resourcesUrl: window.SITE_CONFIG.resourcesUrl\n\n    };\n  },\n  components: {},\n  props: {\n    depId: {\n      required: true\n    }\n  },\n  computed: {\n    defalutSku: function defalutSku() {\n      return this.$store.state.prod.defalutSku;\n    }\n  },\n  activated: function activated() {\n    this.dataForm.prodId = this.$route.query.prodId;\n    this.getDataList();\n  },\n  methods: {\n    // 获取分类数据\n    getDataList: function getDataList() {},\n    delvidio: function delvidio() {\n      this.dataForm.video = '';\n    },\n    handleRemove: function handleRemove(file, fileList) {\n      // let this.dataForm.productImageDtos\n      for (var i = 0; i < this.dataForm.productImageList.length; i++) {\n        if (file.url == this.dataForm.productImageList[i].url) {\n          this.dataForm.productImageList.splice(i, 1);\n        }\n      }\n    },\n    uploadImgTwo: function uploadImgTwo(res) {\n      this.dataForm.productImageList.push({\n        sort: 0,\n        url: res.data\n      });\n    },\n    handlePictureCardPreview: function handlePictureCardPreview(file) {\n      this.dialogImageUrl = file.url;\n      this.dialogVisible = true;\n    },\n    removeDomain: function removeDomain(item) {\n      for (var j = 0; j < this.attributeDepList.length; j++) {\n        if (this.attributeDepList[j].name == item.name) {\n          this.attributeDepList.splice(j, 1);\n        }\n      }\n    },\n    delshoptype: function delshoptype(deltid) {\n      for (var i = 0; i < this.shoptypelist.length; i++) {\n        if (this.shoptypelist[i].tid == deltid) {\n          this.shoptypelist.splice(i, 1);\n        }\n      }\n    },\n    uploadImg: function uploadImg(res) {\n      this.dataForm.cover = res.data;\n      this.imageShowUrl = res.data;\n      this.rules.picfile = [{\n        required: true,\n        message: '请上传图片'\n      }];\n\n      if (this.dataForm.cover != '') {\n        this.rules.picfile = [];\n      }\n    },\n    beforeAvatarUpload: function beforeAvatarUpload(file) {\n      var isJPG = file.type === 'image/jpeg' || file.type === 'image/png';\n      var isLt2M = file.size / 1024 / 1024 < 2;\n\n      if (!isJPG) {\n        this.$message.error('上传头像图片只能是 JPG或者PNG 格式!');\n      }\n\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 2MB!');\n      }\n\n      return isJPG && isLt2M;\n    },\n    // 视频上传\n    beforeUploadVideo: function beforeUploadVideo(file) {\n      //视频上传之前判断他的大小\n      var isLt10M = file.size / 1024 / 1024 < 2000;\n\n      if (!isLt10M) {\n        this.$message.error('上传视频大小不能超过2000MB哦!');\n        return false;\n      }\n    },\n    uploadVideoProcess: function uploadVideoProcess(event, file, fileList) {\n      //视频上传的时候获取上传进度传给进度条\n      this.videoFlag = true;\n      this.videoUploadPercent = parseInt(file.percentage); // console.log(this.videoUploadPercent)\n    },\n    handleVideoSuccess: function handleVideoSuccess(res, file) {\n      //视频上传成功之后返回视频地址\n      this.videoFlag = false;\n      this.videoUploadPercent = 0; // console.log(res)\n\n      this.dataForm.video = '';\n      console.log(this.dataForm.video);\n      this.dataForm.video = res.data;\n    },\n    // 表单提交\n    dataFormSubmit: function dataFormSubmit() {\n      var _this = this;\n\n      var that = this;\n      this.$refs['dataForm'].validate(function (valid) {\n        if (valid) {\n          if (_this.shopid != 0) {\n            var putdata = {\n              cover: _this.dataForm.cover,\n              detailMobile: _this.dataForm.detailMobile,\n              price: _this.dataForm.price,\n              typeId: _this.dataForm.typeId,\n              productImageList: _this.dataForm.productImageList,\n              productIntro: _this.dataForm.productIntro,\n              productNumber: _this.dataForm.productNumber,\n              sales: _this.dataForm.sales,\n              title: _this.dataForm.title,\n              totalStock: _this.dataForm.totalStock,\n              video: _this.dataForm.video,\n              pid: _this.shopid,\n              retailFreightId: _this.dataForm.retailFreightId\n            };\n            putProdDataAPI(putdata).then(function (res) {\n              var sucresponse = res.data;\n\n              if (sucresponse.code == 200) {\n                _this.$message({\n                  type: 'success',\n                  message: '修改产品成功'\n                });\n\n                _this.$emit('close-form');\n\n                _this.$emit('finish-action');\n              } else {\n                _this.errorMsg(sucresponse.message);\n              }\n            }).catch(function (err) {\n              console.log(err);\n              _this.tableLoading = false;\n            });\n          } else {\n            var pushdata = {\n              cover: _this.dataForm.cover,\n              detailMobile: _this.dataForm.detailMobile,\n              price: _this.dataForm.price,\n              typeId: _this.dataForm.typeId,\n              productImageList: _this.dataForm.productImageList,\n              productIntro: _this.dataForm.productIntro,\n              productNumber: _this.dataForm.productNumber,\n              sales: _this.dataForm.sales,\n              title: _this.dataForm.title,\n              totalStock: _this.dataForm.totalStock,\n              video: _this.dataForm.video,\n              retailFreightId: _this.dataForm.retailFreightId\n            };\n            pushProdDataAPI(pushdata).then(function (res) {\n              var response = res.data;\n\n              if (response.code == 200) {\n                _this.$message({\n                  type: 'success',\n                  message: '添加产品成功'\n                });\n\n                _this.$emit('close-form');\n\n                _this.$emit('finish-action');\n              } else {\n                _this.errorMsg(response.message);\n              }\n            }).catch(function (err) {\n              console.log(err);\n              _this.tableLoading = false;\n            });\n          }\n        }\n      });\n    },\n    getproddetail: function getproddetail(id) {\n      var _this2 = this;\n\n      getProdDetailAPI(id).then(function (res) {\n        var data = res.data.data;\n        console.log(data);\n        _this2.dataForm = data;\n        var editor = new E('#editorElem');\n\n        editor.customConfig.onchange = function (html) {\n          _this2.dataForm.detailMobile = html;\n        };\n\n        _this2.rules.picfile = [{\n          required: true,\n          message: '请上传图片'\n        }];\n\n        if (_this2.dataForm.cover != '') {\n          _this2.rules.picfile = [];\n        }\n\n        editor.customConfig.customUploadImg = function (files, insert) {\n          var formData = new FormData();\n          formData.append('files', files[0]);\n          axios.post(\"http://admin.zhanchengwlkj.com:8080/distribution_backstage/file/addFile\", formData, {\n            headers: {\n              \"Content-Type\": \"multipart/form-data\"\n            }\n          }).then(function (res) {\n            var data = res.data;\n            insert(data.data); // 插入图片到editor\n          }); // formData.append('path', 'files/ne-icev3-dashboard/content/content/');\n        };\n\n        editor.customConfig.uploadImgShowBase64 = true; //图片以base64形式保存\n\n        editor.create();\n        editor.txt.html(_this2.dataForm.detailMobile);\n      }).catch(function (err) {\n        _this2.tableLoading = false;\n      });\n    },\n    errorMsg: function errorMsg(message) {\n      this.$message({\n        message: message,\n        type: 'error',\n        duration: 1500\n      });\n    },\n    getfreightlist: function getfreightlist() {\n      var _this3 = this;\n\n      var getTempParam = {\n        current: 1,\n        size: 100\n      };\n      getTemplateListAPI(getTempParam).then(function (res) {\n        var response = res.data.data.records;\n        _this3.freightlist = response;\n      }).catch(function (err) {\n        _this3.tableLoading = false;\n      });\n    },\n    geprodTypelist: function geprodTypelist() {\n      var _this4 = this;\n\n      var getTempParam = {\n        current: 1,\n        size: 100\n      };\n      getprodTypeListtAPI(getTempParam).then(function (res) {\n        var response = res.data.data;\n        _this4.prodtypelist = response;\n      }).catch(function (err) {\n        _this4.tableLoading = false;\n      });\n    }\n  },\n  mounted: function mounted() {\n    var _this5 = this;\n\n    //wangEditor自带方法\n    if (this.depId != 0) {\n      this.shopid = this.depId;\n      this.getproddetail(this.depId);\n    } else {\n      var editor = new E('#editorElem');\n      editor.customConfig.uploadImgShowBase64 = true; //图片以base64形式保存\n\n      editor.customConfig.onchange = function (html) {\n        _this5.dataForm.detailMobile = html;\n      };\n\n      editor.customConfig.customUploadImg = function (files, insert) {\n        var formData = new FormData();\n        formData.append('files', files[0]);\n        axios.post(\"http://admin.zhanchengwlkj.com:8080/distribution_backstage/file/addFile\", formData, {\n          headers: {\n            \"Content-Type\": \"multipart/form-data\"\n          }\n        }).then(function (res) {\n          var data = res.data;\n          insert(data.data); // 插入图片到editor\n        }); // formData.append('path', 'files/ne-icev3-dashboard/content/content/');\n      };\n\n      editor.customConfig.uploadImgShowBase64 = true; //图片以base64形式保存\n\n      editor.create();\n    }\n\n    this.geprodTypelist();\n    this.getfreightlist();\n  }\n};",null]}